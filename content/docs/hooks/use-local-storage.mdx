---
title: useLocalStorage
description: A custom hook that manages state synchronized with localStorage.
---

## Installation

<CodeTabs>
  <TabsList>
    <TabsTrigger value="cli">CLI</TabsTrigger>
    <TabsTrigger value="manual">Manual</TabsTrigger>
  </TabsList>
  
  <TabsContent value="cli">
    ```package-install
    npx shadcn@latest add https://react-usekit.vercel.app/r/use-local-storage.json
    ```
  </TabsContent>
  
  <TabsContent value="manual">
    Copy and paste the following code into your project.

    ```ts title="hooks/use-local-storage.ts"
    import { useCallback, useEffect, useRef, useState } from "react";

    /**
     * A custom hook that manages state synchronized with localStorage.
     * Enhanced with custom serializers, remove functionality, and improved cross-tab sync.
     *
     * @param {string} key The localStorage key to use
     * @param {*} initialValue The initial value if no value exists in localStorage
     * @param {Object} options Configuration options for the hook
     * @param {Object} options.serializer Custom serializer function with read/write methods
     * @param {boolean} options.syncData Whether to sync data across tabs (default: true)
     * @param {boolean} options.initializeWithValue Whether to initialize with value from localStorage (default: true)
     * @returns {[*, function, function]} Returns [value, setValue, removeValue]
     */

    /**
     * Options for the useLocalStorage hook
     */
    export interface UseLocalStorageOptions<T> {
      /** Custom serializer function */
      serializer?: {
        read: (value: string) => T;
        write: (value: T) => string;
      };
      /** Function to determine if the value should be synced across tabs */
      syncData?: boolean;
      /** Custom event name for cross-tab synchronization */
      initializeWithValue?: boolean;
    }

    /**
     * Return type for useLocalStorage hook
     */
    export type UseLocalStorageReturn<T> = [
      T,
      (value: T | ((val: T) => T)) => void,
      () => void
    ];

    // Custom hook to create a stable event callback
    function useEventCallback<Args extends unknown[], Return>(
      fn: (...args: Args) => Return
    ): (...args: Args) => Return {
      const ref = useRef<typeof fn>(fn);

      useEffect(() => {
        ref.current = fn;
      });

      return useCallback((...args: Args) => {
        return ref.current!(...args);
      }, []);
    }

    // Custom hook to listen for localStorage events
    function useLocalStorageEventListener(callback: (e: StorageEvent) => void) {
      const eventCallback = useEventCallback(callback);

      useEffect(() => {
        if (typeof window === "undefined") {
          return;
        }

        window.addEventListener("storage", eventCallback);
        return () => window.removeEventListener("storage", eventCallback);
      }, [eventCallback]);
    }

    /**
     * Default serializer for localStorage values
     */
    const defaultSerializer = {
      read: (value: string) => {
        try {
          return JSON.parse(value);
        } catch {
          return value;
        }
      },
      write: (value: unknown) => JSON.stringify(value),
    };

    /**
     * Read a value from localStorage
     */
    function readLocalStorageValue<T>(
      key: string,
      initialValue: T,
      serializer: { read: (value: string) => T; write: (value: T) => string }
    ): T {
      if (typeof window === "undefined") {
        return initialValue;
      }

      try {
        const item = window.localStorage.getItem(key);
        return item !== null ? serializer.read(item) : initialValue;
      } catch (error) {
        console.warn(`Error reading localStorage key "${key}":`, error);
        return initialValue;
      }
    }

    /**
     * Write a value to localStorage
     */
    function writeLocalStorageValue<T>(
      key: string,
      value: T,
      serializer: { read: (value: string) => T; write: (value: T) => string }
    ): void {
      if (typeof window === "undefined") {
        return;
      }

      try {
        window.localStorage.setItem(key, serializer.write(value));
      } catch (error) {
        console.warn(`Error setting localStorage key "${key}":`, error);
      }
    }

    export function useLocalStorage<T>(
      key: string,
      initialValue: T,
      options: UseLocalStorageOptions<T> = {}
    ): UseLocalStorageReturn<T> {
      const {
        serializer = defaultSerializer as {
          read: (value: string) => T;
          write: (value: T) => string;
        },
        syncData = true,
        initializeWithValue = true,
      } = options;

      // Get the initial value from localStorage or use the provided initial value
      const [storedValue, setStoredValue] = useState<T>(() => {
        if (!initializeWithValue) {
          return initialValue;
        }
        return readLocalStorageValue(key, initialValue, serializer);
      });

      // Return a wrapped version of useState's setter function that persists the new value to localStorage
      const setValue = useEventCallback((value: T | ((val: T) => T)) => {
        if (typeof window === "undefined") {
          console.warn(
            `Tried setting localStorage key "${key}" even though environment is not a client`
          );
          return;
        }

        try {
          // Allow value to be a function so we have the same API as useState
          const newValue = value instanceof Function ? value(storedValue) : value;

          // Save to localStorage
          writeLocalStorageValue(key, newValue, serializer);

          // Save state
          setStoredValue(newValue);

          // Dispatch a custom event to notify other useLocalStorage hooks
          if (syncData) {
            window.dispatchEvent(
              new CustomEvent("local-storage", {
                detail: {
                  key,
                  newValue,
                },
              })
            );
          }
        } catch (error) {
          console.warn(`Error setting localStorage key "${key}":`, error);
        }
      });

      // Function to remove the value from localStorage
      const removeValue = useEventCallback(() => {
        if (typeof window === "undefined") {
          console.warn(
            `Tried removing localStorage key "${key}" even though environment is not a client`
          );
          return;
        }

        try {
          window.localStorage.removeItem(key);
          setStoredValue(initialValue);

          // Dispatch a custom event to notify other useLocalStorage hooks
          if (syncData) {
            window.dispatchEvent(
              new CustomEvent("local-storage", {
                detail: {
                  key,
                  newValue: initialValue,
                },
              })
            );
          }
        } catch (error) {
          console.warn(`Error removing localStorage key "${key}":`, error);
        }
      });

      // Listen for changes to localStorage from other tabs/windows
      useLocalStorageEventListener(
        useEventCallback((e: StorageEvent) => {
          if (e.key === key && e.newValue !== e.oldValue && syncData) {
            try {
              if (e.newValue === null) {
                setStoredValue(initialValue);
              } else {
                setStoredValue(serializer.read(e.newValue));
              }
            } catch (error) {
              console.warn(`Error parsing localStorage key "${key}":`, error);
            }
          }
        })
      );

      // Listen for custom local-storage events (for same-tab synchronization)
      useEffect(() => {
        if (!syncData) return;

        const handleCustomEvent = (e: CustomEvent) => {
          if (e.detail?.key === key && e.detail?.newValue !== undefined) {
            setStoredValue(e.detail.newValue);
          }
        };

        window.addEventListener(
          "local-storage",
          handleCustomEvent as EventListener
        );
        return () =>
          window.removeEventListener(
            "local-storage",
            handleCustomEvent as EventListener
          );
      }, [key, syncData]);

      return [storedValue, setValue, removeValue];
    }

    ```

  </TabsContent>
</CodeTabs>

## Usage

```tsx
import { useLocalStorage } from "@/hooks/use-local-storage";

function App() {
  const [theme, setTheme] = useLocalStorage("theme", "light");
  const [name, setName, removeName] = useLocalStorage("userName", "");

  return (
    <div>
      <div>
        <label>Theme: </label>
        <select value={theme} onChange={(e) => setTheme(e.target.value)}>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>
      <div>
        <label>Name: </label>
        <input
          type="text"
          value={name}
          onChange={(e) => setName(e.target.value)}
        />
        <button onClick={removeName}>Clear</button>
      </div>
      <p>Current theme: {theme}</p>
      <p>Hello, {name || "Guest"}!</p>
    </div>
  );
}
```

## Custom Serializer Example

```tsx
import { useLocalStorage } from "@/hooks/use-local-storage";

type InstallationType = "cli" | "manual";

function ConfigExample() {
  // Store raw string values without JSON quotes
  const [installType, setInstallType] = useLocalStorage<InstallationType>(
    "installationType",
    "cli",
    {
      serializer: {
        read: (value: string) => (value === "manual" ? "manual" : "cli"),
        write: (value: InstallationType) => value, // Stores "cli" instead of "\"cli\""
      },
    }
  );

  // Custom serializer for dates
  const [lastLogin, setLastLogin] = useLocalStorage("lastLogin", new Date(), {
    serializer: {
      read: (value: string) => new Date(value),
      write: (value: Date) => value.toISOString(),
    },
  });

  return (
    <div>
      <p>Install Type: {installType}</p>
      <button onClick={() => setInstallType("manual")}>Set Manual</button>
      <button onClick={() => setInstallType("cli")}>Set CLI</button>

      <p>Last Login: {lastLogin.toLocaleString()}</p>
      <button onClick={() => setLastLogin(new Date())}>
        Update Login Time
      </button>
    </div>
  );
}
```

## API

### Parameters

| Parameter      | Type     | Description                          |
| -------------- | -------- | ------------------------------------ |
| `key`          | `string` | The localStorage key to use          |
| `initialValue` | `T`      | The initial value if no value exists |
| `options`      | `object` | Configuration options                |

### Options

| Option                | Type      | Default | Description                                   |
| --------------------- | --------- | ------- | --------------------------------------------- |
| `serializer`          | `object`  | JSON    | Custom serializer with read/write methods     |
| `syncData`            | `boolean` | `true`  | Whether to sync data across tabs              |
| `initializeWithValue` | `boolean` | `true`  | Whether to initialize with localStorage value |

### Returns

| Name          | Type                                    | Description                               |
| ------------- | --------------------------------------- | ----------------------------------------- |
| `value`       | `T`                                     | The current value                         |
| `setValue`    | `(value: T \| ((val: T) => T)) => void` | Function to set the value                 |
| `removeValue` | `() => void`                            | Function to remove the value from storage |
